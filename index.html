<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="V-Metrics">
    <link rel="apple-touch-icon" href="V-Metrics.white.png"> <link rel="manifest" href="manifest.json">
    <link rel="icon" href="V-Metrics.png" type="image/png">
    <title>V-Metrics</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="home-screen">
        <h1 class="app-title">
            <img src="V-Metrics.png" id="home-icon" class="home-icon-image" />
            <img src="logo.png" alt="V-Metrics" id="home-logo" class="home-logo-image" />
        </h1>
        <div class="menu-grid">
            <div class="menu-card" id="menu-new-match">
                <h2>試合記録</h2>
                <p>新しい試合を開始する</p>
            </div>
            <div class="menu-card" id="menu-analysis">
                <h2>データ分析</h2>
                <p>試合結果を振り返る</p>
            </div>
            <div class="menu-card" id="menu-players">
                <h2>選手管理</h2>
                <p>選手名や背番号を登録する</p>
            </div>
            <div class="menu-card" id="menu-settings">
                <h2>設定</h2>
                <p>データの修正・削除、CSV出入力</p>
            </div>
        </div>
    </div>
    <div id="players-screen" style="display: none;">
        <header class="screen-header">
            <img src="logo.png" alt="V-Metrics" id="logo-ps" class="logo-image" />
            <h1>選手管理</h1>
            <button id="btn-add-player" class="action-btn submit">新規登録</button>
        </header>
        <div class="players-list-container">
            <table id="players-table">
                <thead>
                    <tr>
                        <th>背番号</th>
                        <th>名前</th>
                        <th>ポジション</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="players-table-body">
                    </tbody>
            </table>
        </div>
    </div>
    <div id="player-edit-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2>選手登録</h2>
            <div class="modal-body">
                <input type="hidden" id="edit-player-id"> <div class="select-group">
                    <label>名&nbsp;前</label>
                    <input type="text" id="input-player-name" placeholder="例: 山梨太郎">
                </div>
                <div class="select-group">
                    <label>背番号</label>
                    <input type="number" id="input-player-jersey" placeholder="例: 1">
                </div>
                <div class="select-group">
                    <label>ポジション (任意)</label>
                    <select id="input-player-position">
                        <option value="OH">レフト</option>
                        <option value="MB">センター </option>
                        <option value="OP">ライト</option>
                        <option value="S">セッター</option>
                        <option value="LB">リベロ</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button id="btn-player-cancel" class="action-btn cancel">キャンセル</button>
                <button id="btn-player-save" class="action-btn submit">保&nbsp;存</button>
            </div>
        </div>
    </div>
    <div id="settings-screen" style="display: none;">
        <header class="screen-header">
            <img src="logo.png" alt="V-Metrics" id="logo-ss" class="logo-image" />
            <h1>設定・データ管理</h1>
        </header>
        <div class="settings-content" style="padding: 20px; max-width: 900px; margin: 0 auto; padding-bottom: 100px;">
            <div class="setting-card">
                <h3>データの入出力</h3>
                <div style="display:flex; gap:10px; margin-top:10px;">
                    <button id="btn-export-csv" class="action-btn submit" style="flex:1;">出力（ .csv ）</button>
                    <button id="btn-import-csv" class="action-btn" style="flex:1; background-color:var(--navy);">入力（ .csv ）</button>
                    <input type="file" id="csv-file-input" accept=".csv" style="display: none;">
                </div>
                <p id="import-status" style="color: var(--orange); margin-top: 5px; display: none;"></p>
            </div>
            <div class="setting-card">
                <h3>データの修正・削除</h3>
                <p>試合やセットを選んで、データの修正や削除ができます。</p>
                <div id="data-explorer" style="max-height: 400px; overflow-y: auto; border: 1px solid #555; border-radius: 5px; background: #222; padding: 10px;">
                    <p style="text-align:center; color:#888;">データを読み込んでいます...</p>
                </div>
                <div style="margin-top:10px; text-align:right;">
                    <button id="btn-refresh-explorer" class="action-btn small">リスト更新</button>
                </div>
            </div>
            <div class="setting-card">
                <h3>バックアップ保存・データ復旧</h3>
                <div style="display:flex; gap:10px; margin-top:10px;">
                    <button id="btn-backup-json" class="action-btn submit" style="flex:1;">保存（ .json ）</button>
                    <button id="btn-restore-json" class="action-btn" style="flex:1; color:var(--orange);">復元 ( .json )</button>
                    <input type="file" id="json-file-input" accept=".json" style="display:none">
                </div>
            </div>
            <div class="setting-card" style="border-color: var(--red);">
                <h3 style="color: var(--red);">データ初期化</h3>
                <div style="display:flex; flex-direction:column; gap:10px;">
                    <button id="btn-delete-matches-only" class="action-btn" style="background-color: var(--red);">
                        試合データ全削除
                    </button>
                    <button id="btn-delete-all" class="action-btn undo">
                        全てのデータを削除
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div id="analysis-screen" style="display: none;">
        <header class="screen-header">
            <img src="logo.png" alt="V-Metrics" id="logo-as" class="logo-image" />
            <h1>データ分析</h1>
            <div class="header-controls">
                <select id="analysis-category-select" class="filter-select">
                    </select>
                <select id="analysis-opponent-select" class="filter-select">
                    <option value="all">対戦校 (全員)</option>
                    </select>
                <button id="btn-calc-stats" class="action-btn submit">集&nbsp;計</button>
                <button id="btn-share-report" class="action-btn" style="background-color:var(--orange); color:black;">共&nbsp;有</button>
            </div>
        </header>
        <div class="analysis-main">
            <div class="analysis-tabs">
                <button class="tab-btn selected" data-view="overall">全体統計</button>
                <button class="tab-btn" data-view="spiker">個人成績</button>
                <button class="tab-btn" data-view="setter">トス</button>
                <button class="tab-btn" data-view="pass">パス</button>
            </div>
            <div id="overall-analysis" class="analysis-content active">
                <div class="overall-container">
                    <div class="sub-tabs-vertical">
                        <div class="sub-tab-btn selected" data-filter="total">全セット</div>
                        <div class="sub-tab-btn" data-filter="win">勝セット</div>
                        <div class="sub-tab-btn" data-filter="lose">負セット</div>
                    </div>
                    <div class="overall-content">
                        <div id="overall-stats-grid" class="stats-grid">
                            <div class="stats-row">
                                <div class="stats-item"><span class="label">打数</span><span id="stat_TS" class="value">0</span></div>
                                <div class="stats-item"><span class="label">決定数</span><span id="stat_TK" class="value">0</span></div>
                                <div class="stats-item"><span class="label" style="color:#2e7d32;">S.O.率</span><span id="stat_SO" class="value">--.-%</span></div>
                                <div class="stats-item"><span class="label" style="color:#ef6c00;">Break率</span><span id="stat_BR" class="value">--.-%</span></div>
                            </div>
                            <div class="stats-row">
                                <div class="stats-item"><span class="label">セット平均打数</span><span id="stat_AS" class="value">0.0</span></div>
                                <div class="stats-item"><span class="label">セット平均決定数</span><span id="stat_AK" class="value">0.0</span></div>
                                <div class="stats-item"><span class="label">セット平均Aカット数</span><span id="stat_AA" class="value">0.0</span></div>
                                <div class="stats-item"><span class="label">セット平均チャンス数</span><span id="stat_AC" class="value">0.0</span></div>
                            </div>
                        </div>
                        <div id="overall-graphs" class="chart-section">
                            <div class="chart-row">
                                <div class="label-col"><span class="main-label">決定率</span><span id="stat_PK" class="value">--.-%</span></div>
                                <div class="chart-col">
                                    <div class="chart-bar total"><div id="bar_PK_total" class="bar-fill blue"></div></div>
                                    <div class="chart-bar win"><div id="bar_PK_win" class="bar-fill red"></div></div>
                                    <div class="chart-bar lose"><div id="bar_PK_lose" class="bar-fill light-blue"></div></div>
                                </div>
                            </div>
                            <div class="chart-row">
                                <div class="label-col"><span class="main-label">効果率</span><span id="stat_PE" class="value">--.-%</span></div>
                                <div class="chart-col">
                                    <div class="chart-bar total"><div id="bar_PE_total" class="bar-fill blue"></div></div>
                                    <div class="chart-bar win"><div id="bar_PE_win" class="bar-fill red"></div></div>
                                    <div class="chart-bar lose"><div id="bar_PE_lose" class="bar-fill light-blue"></div></div>
                                </div>
                            </div>
                            <div class="chart-row">
                                <div class="label-col"><span class="main-label">A&C決定率</span><span id="stat_PCA" class="value">--.-%</span></div>
                                <div class="chart-col">
                                    <div class="chart-bar total"><div id="bar_PCA_total" class="bar-fill blue"></div></div>
                                    <div class="chart-bar win"><div id="bar_PCA_win" class="bar-fill red"></div></div>
                                    <div class="chart-bar lose"><div id="bar_PCA_lose" class="bar-fill light-blue"></div></div>
                                </div>
                            </div>
                            <div class="chart-row">
                                <div class="label-col"><span class="main-label">失点率</span><span id="stat_PF" class="value">--.-%</span></div>
                                <div class="chart-col">
                                    <div class="chart-bar total"><div id="bar_PF_total" class="bar-fill blue"></div></div>
                                    <div class="chart-bar win"><div id="bar_PF_win" class="bar-fill red"></div></div>
                                    <div class="chart-bar lose"><div id="bar_PF_lose" class="bar-fill light-blue"></div></div>
                                </div>
                            </div>
                        </div>
                        <div class="chart-container" style="padding: 20px; background: #f9f9f9; border-radius: 8px;">
                            <h3 style="color: var(--navy); font-size: 1.1em; margin-bottom: 10px; border-left: 4px solid var(--navy); padding-left: 10px;">セット別パフォーマンス推移</h3>
                            <div style="position: relative; height: 300px; width: 100%;">
                                <canvas id="chart-set-transition"></canvas>
                            </div>
                        </div>
                        <div class="chart-panel">
                            <h3 class="chart-title">ローテーション別 サイドアウト・ブレイク率</h3>
                            <div style="height: 300px;">
                                <canvas id="chart-rotation-breakdown"></canvas>
                            </div>
                        </div>
                        <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                            <div class="chart-panel" style="flex: 1; min-width: 300px;">
                                <h3 class="chart-title">得点の内訳 (Points)</h3>
                                <div style="height: 250px; display:flex; justify-content:center;">
                                    <canvas id="chart-point-breakdown"></canvas>
                                </div>
                            </div>
                            <div class="chart-panel" style="flex: 1; min-width: 300px;">
                                <h3 class="chart-title">失点の内訳 (Errors)</h3>
                                <div style="height: 250px; display:flex; justify-content:center;">
                                    <canvas id="chart-error-breakdown"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="chart-panel">
                            <h3 class="chart-title">セット別パフォーマンス推移</h3>
                            <div style="height: 250px;">
                                <canvas id="chart-set-transition"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="spiker-analysis" class="analysis-content">
                <div class="filter-controls">
                    <div class="filter-group">
                        <span>選手:</span>
                        <select id="playerFilter" class="filter-select"></select>
                    </div>
                    <div class="filter-group">
                        <span>セット:</span>
                        <select id="setFilter" class="filter-select">
                            <option value="total">全セット</option>
                            <option value="win">勝セット</option>
                            <option value="lose">負セット</option>
                        </select>
                    </div>
                    <div class="tab-controls">
                        <button id="spikerTab1" class="tab-btn selected">成績</button>
                        <button id="spikerTab2" class="tab-btn">トス別</button>
                    </div>
                </div>
                <div id="spiker-table-view" class="analysis-table">
                    <table>
                        <thead>
                            <tr>
                                <th>選手</th><th>Set平均</th><th>決定率</th><th>効果率</th><th>有効率</th><th>失点率</th>
                                <th>Chance</th><th>A</th><th>A&C</th><th>DC</th><th>B</th><th>2段</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <h3 style="color:var(--navy); margin: 10px 0 5px; font-size:1rem; border-left:4px solid var(--navy); padding-left:8px;">
                        サーブ (Serve)
                    </h3>
                    <div style="overflow-x: auto;">
                        <table id="tbl-spiker-serve" class="data-table" style="width:100%; border-collapse:collapse; white-space:nowrap;">
                            <thead>
                                <tr style="background:#f5f5f5; border-bottom:2px solid #ccc;">
                                    <th>選手名</th>
                                    <th>打数</th>
                                    <th style="color:blue;">得点</th>
                                    <th style="color:red;">ミス</th>
                                    <th>効果率</th>
                                    <th>ミスの割合</th>
                                </tr>
                            </thead>
                            <tbody>
                                </tbody>
                        </table>
                    </div>
                </div>
                <div id="spiker-table-view-2" class="analysis-table hidden">
                    <table>
                        <thead>
                            <tr>
                                <th>選手</th><th>決定率</th><th>効果率</th><th>有効率</th><th>失点率</th>
                                <th>Good</th><th>割</th><th>近</th><th>長</th><th>短</th><th>高</th><th>低</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div id="spiker-graph-view" class="hidden">
                    <div id="spiker-graphs" class="chart-section viewing-total">
                        <div class="stats-grid">
                            <div class="stats-row">
                                <div class="stats-item"><span class="label">総スパイク数</span><span class="value" id="stat_TS_spiker">0 本</span></div>
                                <div class="stats-item"><span class="label">総決定数</span><span class="value" id="stat_TK_spiker">0 本</span></div>
                                <div class="stats-item"><span class="label">総失点数</span><span class="value" id="stat_TF_spiker">0 本</span></div>
                            </div>
                        </div>
                        <div class="chart-row">
                            <div class="label-col"><p class="main-label">決定率</p><p class="percentage" id="stat_PK_spiker">0%</p></div>
                            <div class="chart-col">
                                <div class="chart-bar-container">
                                    <div class="chart-bar-label"><span>全</span><span>勝</span><span>負</span></div>
                                    <div class="chart-bar-group">
                                        <div class="chart-bar total"><div id="bar_PK_total_spiker" class="bar-fill blue" style="width: 0%;"></div></div>
                                        <div class="chart-bar win"><div id="bar_PK_win_spiker" class="bar-fill red" style="width: 0%;"></div></div>
                                        <div class="chart-bar lose"><div id="bar_PK_lose_spiker" class="bar-fill light-blue" style="width: 0%;"></div></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="chart-row">
                            <div class="label-col"><p class="main-label">効果率</p><p class="percentage" id="stat_PE_spiker">0%</p></div>
                            <div class="chart-col">
                                <div class="chart-bar-container">
                                    <div class="chart-bar-label"><span>全</span><span>勝</span><span>負</span></div>
                                    <div class="chart-bar-group">
                                        <div class="chart-bar total"><div id="bar_PE_total_spiker" class="bar-fill blue" style="width: 0%;"></div></div>
                                        <div class="chart-bar win"><div id="bar_PE_win_spiker" class="bar-fill red" style="width: 0%;"></div></div>
                                        <div class="chart-bar lose"><div id="bar_PE_lose_spiker" class="bar-fill light-blue" style="width: 0%;"></div></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="chart-row">
                            <div class="label-col"><p class="main-label">有効率</p><p class="percentage" id="stat_PKE_spiker">0%</p></div>
                            <div class="chart-col">
                                <div class="chart-bar-container">
                                    <div class="chart-bar-label"><span>全</span><span>勝</span><span>負</span></div>
                                    <div class="chart-bar-group">
                                        <div class="chart-bar total"><div id="bar_PKE_total_spiker" class="bar-fill blue" style="width: 0%;"></div></div>
                                        <div class="chart-bar win"><div id="bar_PKE_win_spiker" class="bar-fill red" style="width: 0%;"></div></div>
                                        <div class="chart-bar lose"><div id="bar_PKE_lose_spiker" class="bar-fill light-blue" style="width: 0%;"></div></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="chart-row">
                            <div class="label-col"><p class="main-label">失点率</p><p class="percentage" id="stat_PF_spiker">0%</p></div>
                            <div class="chart-col">
                                <div class="chart-bar-container">
                                    <div class="chart-bar-label"><span>全</span><span>勝</span><span>負</span></div>
                                    <div class="chart-bar-group">
                                        <div class="chart-bar total"><div id="bar_PF_total_spiker" class="bar-fill blue" style="width: 0%;"></div></div>
                                        <div class="chart-bar win"><div id="bar_PF_win_spiker" class="bar-fill red" style="width: 0%;"></div></div>
                                        <div class="chart-bar lose"><div id="bar_PF_lose_spiker" class="bar-fill light-blue" style="width: 0%;"></div></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="chart-row">
                            <div class="label-col"><p class="main-label">C決定率</p><p class="percentage" id="stat_PC_spiker">0%</p></div>
                            <div class="chart-col">
                                <div class="chart-bar-container">
                                    <div class="chart-bar-label"><span>全</span><span>勝</span><span>負</span></div>
                                    <div class="chart-bar-group">
                                        <div class="chart-bar total"><div id="bar_PC_total_spiker" class="bar-fill blue" style="width: 0%;"></div></div>
                                        <div class="chart-bar win"><div id="bar_PC_win_spiker" class="bar-fill red" style="width: 0%;"></div></div>
                                        <div class="chart-bar lose"><div id="bar_PC_lose_spiker" class="bar-fill light-blue" style="width: 0%;"></div></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="chart-row">
                            <div class="label-col"><p class="main-label">A決定率</p><p class="percentage" id="stat_PA_spiker">0%</p></div>
                            <div class="chart-col">
                                <div class="chart-bar-container">
                                    <div class="chart-bar-label"><span>全</span><span>勝</span><span>負</span></div>
                                    <div class="chart-bar-group">
                                        <div class="chart-bar total"><div id="bar_PA_total_spiker" class="bar-fill blue" style="width: 0%;"></div></div>
                                        <div class="chart-bar win"><div id="bar_PA_win_spiker" class="bar-fill red" style="width: 0%;"></div></div>
                                        <div class="chart-bar lose"><div id="bar_PA_lose_spiker" class="bar-fill light-blue" style="width: 0%;"></div></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="chart-row">
                            <div class="label-col"><p class="main-label">C&A決定率</p><p class="percentage" id="stat_PCA_spiker">0%</p></div>
                            <div class="chart-col">
                                <div class="chart-bar-container">
                                    <div class="chart-bar-label"><span>全</span><span>勝</span><span>負</span></div>
                                    <div class="chart-bar-group">
                                        <div class="chart-bar total"><div id="bar_PCA_total_spiker" class="bar-fill blue" style="width: 0%;"></div></div>
                                        <div class="chart-bar win"><div id="bar_PCA_win_spiker" class="bar-fill red" style="width: 0%;"></div></div>
                                        <div class="chart-bar lose"><div id="bar_PCA_lose_spiker" class="bar-fill light-blue" style="width: 0%;"></div></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="chart-row">
                            <div class="label-col"><p class="main-label">DC決定率</p><p class="percentage" id="stat_PKH_spiker">0%</p></div>
                            <div class="chart-col">
                                <div class="chart-bar-container">
                                    <div class="chart-bar-label"><span>全</span><span>勝</span><span>負</span></div>
                                    <div class="chart-bar-group">
                                        <div class="chart-bar total"><div id="bar_PKH_total_spiker" class="bar-fill blue" style="width: 0%;"></div></div>
                                        <div class="chart-bar win"><div id="bar_PKH_win_spiker" class="bar-fill red" style="width: 0%;"></div></div>
                                        <div class="chart-bar lose"><div id="bar_PKH_lose_spiker" class="bar-fill light-blue" style="width: 0%;"></div></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="chart-row">
                            <div class="label-col"><p class="main-label">B決定率</p><p class="percentage" id="stat_PB_spiker">0%</p></div>
                            <div class="chart-col">
                                <div class="chart-bar-container">
                                    <div class="chart-bar-label"><span>全</span><span>勝</span><span>負</span></div>
                                    <div class="chart-bar-group">
                                        <div class="chart-bar total"><div id="bar_PB_total_spiker" class="bar-fill blue" style="width: 0%;"></div></div>
                                        <div class="chart-bar win"><div id="bar_PB_win_spiker" class="bar-fill red" style="width: 0%;"></div></div>
                                        <div class="chart-bar lose"><div id="bar_PB_lose_spiker" class="bar-fill light-blue" style="width: 0%;"></div></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="chart-row">
                            <div class="label-col"><p class="main-label">2段決定率</p><p class="percentage" id="stat_P2_spiker">0%</p></div>
                            <div class="chart-col">
                                <div class="chart-bar-container">
                                    <div class="chart-bar-label"><span>全</span><span>勝</span><span>負</span></div>
                                    <div class="chart-bar-group">
                                        <div class="chart-bar total"><div id="bar_P2_total_spiker" class="bar-fill blue" style="width: 0%;"></div></div>
                                        <div class="chart-bar win"><div id="bar_P2_win_spiker" class="bar-fill red" style="width: 0%;"></div></div>
                                        <div class="chart-bar lose"><div id="bar_P2_lose_spiker" class="bar-fill light-blue" style="width: 0%;"></div></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="spiker-toss-graph-view" class="chart-section hidden">
                    <div class="chart-row">
                        <div class="label-col"><p class="main-label">〇</p><p class="percentage" id="stat_good_spiker">0本</p></div>
                        <div class="chart-col">
                            <div class="chart-bar-container">
                                <div class="chart-bar-label"><span>決定</span><span>有効</span><span>失点</span></div>
                                <div class="chart-bar-group">
                                    <div class="chart-bar"><div id="bar_good_K_spiker" class="bar-fill green"></div></div>
                                    <div class="chart-bar"><div id="bar_good_E_spiker" class="bar-fill orange"></div></div>
                                    <div class="chart-bar"><div id="bar_good_F_spiker" class="bar-fill red"></div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="chart-row">
                        <div class="label-col"><p class="main-label">割</p><p class="percentage" id="stat_far_spiker">0本</p></div>
                        <div class="chart-col">
                            <div class="chart-bar-container">
                                <div class="chart-bar-label"><span>決定</span><span>有効</span><span>失点</span></div>
                                <div class="chart-bar-group">
                                    <div class="chart-bar"><div id="bar_far_K_spiker" class="bar-fill green"></div></div>
                                    <div class="chart-bar"><div id="bar_far_E_spiker" class="bar-fill orange"></div></div>
                                    <div class="chart-bar"><div id="bar_far_F_spiker" class="bar-fill red"></div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="chart-row">
                        <div class="label-col"><p class="main-label">近</p><p class="percentage" id="stat_near_spiker">0本</p></div>
                        <div class="chart-col">
                            <div class="chart-bar-container">
                                <div class="chart-bar-label"><span>決定</span><span>有効</span><span>失点</span></div>
                                <div class="chart-bar-group">
                                    <div class="chart-bar"><div id="bar_near_K_spiker" class="bar-fill green"></div></div>
                                    <div class="chart-bar"><div id="bar_near_E_spiker" class="bar-fill orange"></div></div>
                                    <div class="chart-bar"><div id="bar_near_F_spiker" class="bar-fill red"></div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="chart-row">
                        <div class="label-col"><p class="main-label">長</p><p class="percentage" id="stat_long_spiker">0本</p></div>
                        <div class="chart-col">
                            <div class="chart-bar-container">
                                <div class="chart-bar-label"><span>決定</span><span>有効</span><span>失点</span></div>
                                <div class="chart-bar-group">
                                    <div class="chart-bar"><div id="bar_long_K_spiker" class="bar-fill green"></div></div>
                                    <div class="chart-bar"><div id="bar_long_E_spiker" class="bar-fill orange"></div></div>
                                    <div class="chart-bar"><div id="bar_long_F_spiker" class="bar-fill red"></div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="chart-row">
                        <div class="label-col"><p class="main-label">短</p><p class="percentage" id="stat_short_spiker">0本</p></div>
                        <div class="chart-col">
                            <div class="chart-bar-container">
                                <div class="chart-bar-label"><span>決定</span><span>有効</span><span>失点</span></div>
                                <div class="chart-bar-group">
                                    <div class="chart-bar"><div id="bar_short_K_spiker" class="bar-fill green"></div></div>
                                    <div class="chart-bar"><div id="bar_short_E_spiker" class="bar-fill orange"></div></div>
                                    <div class="chart-bar"><div id="bar_short_F_spiker" class="bar-fill red"></div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="chart-row">
                        <div class="label-col"><p class="main-label">高</p><p class="percentage" id="stat_high_spiker">0本</p></div>
                        <div class="chart-col">
                            <div class="chart-bar-container">
                                <div class="chart-bar-label"><span>決定</span><span>有効</span><span>失点</span></div>
                                <div class="chart-bar-group">
                                    <div class="chart-bar"><div id="bar_high_K_spiker" class="bar-fill green"></div></div>
                                    <div class="chart-bar"><div id="bar_high_E_spiker" class="bar-fill orange"></div></div>
                                    <div class="chart-bar"><div id="bar_high_F_spiker" class="bar-fill red"></div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="chart-row">
                        <div class="label-col"><p class="main-label">低</p><p class="percentage" id="stat_low_spiker">0本</p></div>
                        <div class="chart-col">
                            <div class="chart-bar-container">
                                <div class="chart-bar-label"><span>決定</span><span>有効</span><span>失点</span></div>
                                <div class="chart-bar-group">
                                    <div class="chart-bar"><div id="bar_low_K_spiker" class="bar-fill green"></div></div>
                                    <div class="chart-bar"><div id="bar_low_E_spiker" class="bar-fill orange"></div></div>
                                    <div class="chart-bar"><div id="bar_low_F_spiker" class="bar-fill red"></div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="setter-analysis" class="analysis-content">
                <div class="filter-controls">
                    <div class="filter-group">
                        <span>セッター:</span>
                        <select id="setterPlayerFilter" class="filter-select"></select>
                    </div>
                    <div class="filter-group">
                         <span>セット:</span>
                        <select id="setterSetFilter" class="filter-select">
                            <option value="total">Total</option>
                            <option value="win">Win</option>
                            <option value="lose">Lose</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <span>カット:</span>
                        <select id="setterCutFilter" class="filter-select">
                            <option value="all">全カット</option>
                            <option value="A">Aカット</option>
                            <option value="B">Bカット</option>
                            <option value="CHANCE">Chance</option>
                            <option value="AC">A & C</option>
                            <option value="S2">S 2段</option>
                        </select>
                    </div>
                </div>
                <div class="setter-layout-grid">
                    <div class="setter-grid-pie3">
                        <h3>トス配球割合</h3>
                        <div style="position: relative; height: 300px; width: 100%; display: flex; justify-content: center;">
                            <canvas id="chart-setter-distribution"></canvas>
                        </div>
                    </div>
                    <div class="setter-grid-pie1">
                        <h3>トス質（Good/Other/Miss）</h3>
                        <div class="pie-chart-layout">
                            <div id="setterPieChart1" class="pie-chart-visual"></div>
                            <div id="setterPieLegend1" class="pie-legend"></div>
                        </div>
                    </div>
                     <div class="setter-grid-pie2">
                        <h3>トス傾向 (詳細)</h3>
                        <div class="pie-chart-layout">
                            <div id="setterPieChart2" class="pie-chart-visual"></div>
                            <div id="setterPieLegend2" class="pie-legend"></div>
                        </div>
                    </div>
                    <div id="setter-table-view" class="setter-grid-table">
                        <h3>トス質 詳細</h3>
                        <table>
                            </table>
                    </div>
                    <div id="setter-top5-combinations" class="setter-grid-top5">
                        <h3>Top 5</h3>
                        <ul id="setterTop5List"></ul>
                    </div>
                </div>
            </div>
            <div id="pass-analysis" class="analysis-content"> <h3>サーブレシーブ返球率 (開発中)</h3>
                <div id="pass-summary" class="summary-box" style="display:block; background:white;"></div>
            </div>
        </div>
    </div>
    <div id="timeout-screen" class="modal-overlay" style="display: none; z-index: 10000;">
        <div class="timeout-dashboard dark-theme">
            <div class="to-header-dark">
                <div class="to-title">速報レポート / Set <span id="to-set-num">1</span></div>
                <div class="to-score-display">
                    <span id="to-our-score" class="score-val our">0</span>
                    <span class="score-sep" style="color:#555; margin:0 10px;">-</span>
                    <span id="to-opp-score" class="score-val opp">0</span>
                </div>
                <button id="btn-to-action" class="btn-close-dark">閉じる</button>
            </div>
            <div id="to-main-view" class="to-grid">
                <div class="to-card clickable" onclick="TimeoutManager.showDetail('attack')">
                    <div class="card-label">アタック決定率 <span style="font-size:0.8em">▶詳細</span></div>
                    <div class="card-main">
                        <span id="to-kill-rate">0%</span>
                    </div>
                    <div class="card-sub">効果率: <span id="to-eff-rate">0%</span></div>
                    <div class="card-bar-bg"><div id="bar-kill" class="card-bar-fill" style="width:0%"></div></div>
                </div>
                <div class="to-card clickable" onclick="TimeoutManager.showDetail('rotation')">
                    <div class="card-label">サイドアウト率 <span style="font-size:0.8em">▶詳細</span></div>
                    <div class="card-main" style="color:#2ECC71;">
                        <span id="to-so-rate">0%</span>
                    </div>
                    <div class="card-sub">成功: <span id="to-so-win-count">0</span> / 受数: <span id="to-so-count">0</span></div>
                    <div class="card-bar-bg"><div id="bar-so" class="card-bar-fill" style="background:#2ECC71; width:0%"></div></div>
                </div>
                <div class="to-card clickable" onclick="TimeoutManager.showDetail('rotation')">
                    <div class="card-label">ブレイク率 <span style="font-size:0.8em">▶詳細</span></div>
                    <div class="card-main" style="color:#E67E22;">
                        <span id="to-br-rate">0%</span>
                    </div>
                    <div class="card-sub">成功: <span id="to-br-win-count">0</span> / 機会: <span id="to-br-count">0</span></div>
                    <div class="card-bar-bg"><div id="bar-br" class="card-bar-fill" style="background:#E67E22; width:0%"></div></div>
                </div>
                <div class="to-card">
                    <div class="card-label">自チーム得点内訳 <span id="to-total-points" style="color:#fff;">0</span></div>
                    <div class="detail-grid">
                        <div class="detail-item"><span class="detail-label">スパイク</span><span id="p-spike" class="detail-val">0</span></div>
                        <div class="detail-item"><span class="detail-label">サーブ</span><span id="p-serve" class="detail-val">0</span></div>
                        <div class="detail-item"><span class="detail-label">ブロック</span><span id="p-block" class="detail-val">0</span></div>
                        <div class="detail-item"><span class="detail-label">相手ミス</span><span id="p-opp-err" class="detail-val">0</span></div>
                    </div>
                    <div style="margin-top:10px; font-size:0.8rem; color:#888; text-align:center;">
                        自力得点率: <span id="p-self-rate">0%</span>
                    </div>
                </div>
                <div class="to-card">
                    <div class="card-label">自チーム失点内訳 <span id="to-total-errors" style="color:#fff;">0</span></div>
                    <div class="detail-grid">
                        <div class="detail-item"><span class="detail-label">スパイク</span><span id="e-spike" class="detail-val">0</span></div>
                        <div class="detail-item"><span class="detail-label">サーブ</span><span id="e-serve" class="detail-val">0</span></div>
                        <div class="detail-item"><span class="detail-label">レシーブ</span><span id="e-rece" class="detail-val">0</span></div>
                        <div class="detail-item"><span class="detail-label">その他</span><span id="e-other" class="detail-val">0</span></div>
                    </div>
                    <div style="margin-top:10px; font-size:0.8rem; color:#888; text-align:center;">
                        被決定: <span id="e-opp-kill">0</span>
                    </div>
                </div>
                <div class="to-card scorer-card">
                    <div class="card-label">得点リーダー (Total Points)</div>
                    <ul id="to-top-scorers" class="scorer-list-dark"></ul>
                </div>
            </div>
            <div id="to-detail-view">
                <div class="detail-header">
                    <button class="btn-back-dark" onclick="TimeoutManager.hideDetail()">◀ 戻る</button>
                    <div id="to-detail-title" class="detail-title">詳細データ</div>
                </div>
                <div id="to-detail-content" style="flex:1; overflow-y:auto;">
                    </div>
            </div>
        </div>
    </div>
    <div id="record-screen" style="display: none;">
        <div id="left-pane">
            <header id="app-header">
                <img src="logo.png" alt="V-Metrics" id="logo-rs" class="logo-image" />
                <div id="game-controls">
                    <button id="btn-timeout">タイムアウト</button>
                    <button id="btn-set-end">セット終了</button>
                </div>
            </header>

            <div id="court-toss-area">
                <div id="mini-court">
                    <div id="attack-line"></div>
                    <div id="center-line"></div>
                </div>
                <button id="btn-chance" class="special-pass-btn">Chance</button>
                <div id="toss-area-buttons">
                <button class="toss-btn" id="btn-toss-L"><span>L</span></button>
                <button class="toss-btn" id="btn-toss-B"><span>B</span></button>
                <button class="toss-btn" id="btn-toss-A"><span>A</span></button>
                <button class="toss-btn" id="btn-toss-C"><span>C</span></button>
                <button class="toss-btn" id="btn-toss-R"><span>R</span></button>
                <button class="toss-btn" id="btn-toss-BACK">BACK</button>
            </div>
            </div>

            <div id="spiker-grid">
                <div class="player-button" id="grid-pos-1" data-position="1"></div>
                <div class="player-button" id="grid-pos-2" data-position="2"></div>
                <div class="player-button" id="grid-pos-3" data-position="3"></div>
                <div class="player-button" id="grid-pos-4" data-position="4"></div>
                <div class="player-button" id="grid-pos-5" data-position="5"></div>
                <div class="player-button" id="grid-pos-6" data-position="6"></div>
            </div>

        </div>

        <div id="right-pane">
            <div id="scoreboard-section" class="scoreboard-container">
                <div id="scoreboard-competition-name">大会名未設定</div>
                <div class="scoreboard-main">
                    <div id="our-team-name" class="team-name-display">山梨大学</div>
                    <div class="score-box">
                        <div class="score-control">
                            <div id="our-score-display" class="point-score">0</div>
                        </div>
                    </div>
                    <div class="set-count-box">
                        <img src="volleyball.png" alt="●" id="our-serve-icon" class="server-indicator" />
                        <img src="volleyball.png" alt="●" id="opponent-serve-icon" class="server-indicator" />
                        <div id="our-set-display" class="set-score">[0]</div>
                        <div id="hyphen" class="vs-label">ー</div>
                        <div id="opp-set-display" class="set-score">[0]</div>
                    </div>
                    <div class="score-box">
                        <div class="score-control">
                            <div id="opp-score-display" class="point-score">0</div>
                        </div>
                    </div>
                    <div id="opp-team-name" class="team-name-display">Opponent</div>
                </div>
            </div>
            <div id="action-grid"> 
                <div id="score-correction-row">
                    <button class="action-btn small" id="btn-self-plus">自＋１</button>
                    <button class="action-btn small" id="btn-self-minus">自－１</button>
                    <button class="action-btn small" id="btn-server-toggle">⇆</button>
                    <button class="action-btn small" id="btn-opp-plus">相＋１</button>
                    <button class="action-btn small" id="btn-opp-minus">相－１</button>
                </div>
                <button class="action-btn" id="btn-substitute">選手交代</button>
                <button class="action-btn" id="btn-libero">リベロ IN</button>
                <button class="action-btn undo" id="btn-undo">取&nbsp;消</button>
                <button class="action-btn" id="btn-open-log">履歴・修正</button>
                <div id="current-inputs" class="span-2">
                    <div class="input-row three-buttons">
                        <button class="action-btn small" id="btn-input-miss">MISS</button>
                        <button class="action-btn small" id="btn-input-direct">直</button>
                        <button class="action-btn small" id="btn-input-two">ツー</button>
                    </div>
                    <div class="input-row three-buttons">
                        <button class="action-btn small" id="btn-toss-far">割</button>
                        <button class="action-btn small" id="btn-toss-long">長</button>
                        <button class="action-btn small" id="btn-toss-high">高</button>
                    </div>
                    <div class="input-row three-buttons">
                        <button class="action-btn small" id="btn-toss-near">近</button>
                        <button class="action-btn small" id="btn-toss-short">短</button>
                        <button class="action-btn small" id="btn-toss-low">低</button>
                    </div>
                    <div class="input-row">
                        <select id="select-setter">
                            <option value="">トス主</option>
                            </select>
                        <select id="select-pass-pos">
                            <option value="">トス位置</option>
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="CHANCE">Chance</option>
                            <option value="S2">S2</option>
                            <option value="L2">L2</option>
                            <option value="O">O</option>
                            <option value="UNKNOWN">不明</option>
                        </select>
                    </div>
                    <div class="input-row">
                        <select id="select-toss-area">
                            <option value="">トスエリア</option>
                            <option value="L">L</option>
                            <option value="B">B</option>
                            <option value="A">A</option>
                            <option value="C">C</option>
                            <option value="R">R</option>
                            <option value="BACK">BACK</option>
                            <option value="UNKNOWN">不明</option>
                        </select>
                        <select id="select-spiker">
                            <option value="">スパイカー</option>
                            <option value="NONE">なし</option>
                            </select>
                    </div>
                    <div class="input-row">
                        <select id="select-attack-type">
                            <option value="">攻撃種別</option>
                            <optgroup label="スパイク">
                                <option value="LEFT">レフト</option>
                                <option value="RIGHT">ライト</option>
                                <option value="A_QUICK">Aクイック</option>
                                <option value="B_QUICK">Bクイック</option>
                                <option value="C_QUICK">Cクイック</option>
                                <option value="A_SEMI">Aセミ</option>
                                <option value="B_SEMI">Bセミ</option>
                                <option value="C_SEMI">Cセミ</option>
                                <option value="BACK_ATTACK">バックアタック</option>
                            </optgroup>
                            <optgroup label="特殊・ミス">
                                <option value="DIRECT">ダイレクト</option>
                                <option value="TWO_ATTACK">ツーアタック</option>
                                <option value="FOUL">反則・ミス</option>
                            </optgroup>
                        </select>
                        <select id="select-result">
                            <option value="">結果</option>
                            <option value="KILL">決定</option>
                            <option value="EFFECTIVE">有効</option>
                            <option value="CONTINUE">継続</option>
                            <option value="FAULT">失点</option>
                            <option value="BLOCKED">被ブロック</option>
                        </select>
                    </div>
                </div> 
                <button class="action-btn cancel" id="btn-cancel">ク&nbsp;リ&nbsp;ア</button>
                <button class="action-btn submit" id="btn-add">追&nbsp;加</button>
            </div>
        </div>
    </div>
    <div id="match-setup-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content large"> <h2>試合設定</h2>
            <div class="modal-body row-layout">
                <div class="setup-left">
                    <div class="select-group">
                        <label>大会名</label>
                        <input type="text" id="setup-competition" placeholder="例: 東医体">
                    </div>
                    <div class="select-group">
                        <label>対戦相手</label>
                        <input type="text" id="setup-opponent" placeholder="例: A大学">
                    </div>
                    <div class="select-group">
                        <label>試合種別</label>
                        <select id="setup-match-type">
                            <option value="official">公式戦</option>
                            <option value="practice">練習試合</option>
                            <option value="reference">参考試合</option>
                        </select>
                    </div>
                    <hr>
                    <div class="select-group">
                        <label>リベロ1 (主)</label>
                        <select id="setup-libero-1">
                            <option value="">なし</option>
                            </select>
                    </div>
                    <div class="select-group">
                        <label>リベロ2 (副)</label>
                        <select id="setup-libero-2">
                            <option value="">なし</option>
                        </select>
                    </div>
                    <hr>
                    <div class="select-group" style="align-items: center　!important;">
                        <label>次のサーブ権</label>
                        <div class="league-toggle-wrapper">
                            <input type="checkbox" id="setup-first-serve" class="league-toggle-checkbox" checked>
                            <label for="setup-first-serve" class="league-toggle-label">
                                <span class="toggle-text text-our">山梨大学</span>
                                <span class="toggle-text text-opp">相手チーム</span>
                                <div class="toggle-slider-bg"></div>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="setup-right">
                    <h3>スタメン配置</h3>
                    <div class="pattern-controls" style="display:flex; gap:10px; margin-bottom:10px; width:100%; justify-content:center;">
                        <select id="select-pattern" style="max-width:150px;">
                            <option value="">パターンを選択...</option>
                            </select>
                        <button id="btn-load-pattern" class="action-btn small">読&nbsp;込</button>
                        <button id="btn-save-pattern" class="action-btn small">現在の配置を保存</button>
                    </div>
                    <div id="setup-court-container">
                        <div class="setup-court"></div>
                        <button class="starter-btn" id="btn-starter-4" data-pos="4">4 (前左)</button>
                        <button class="starter-btn" id="btn-starter-3" data-pos="3">3 (前中)</button>
                        <button class="starter-btn" id="btn-starter-2" data-pos="2">2 (前右)</button>
                        <button class="starter-btn" id="btn-starter-5" data-pos="5">5 (後左)</button>
                        <button class="starter-btn" id="btn-starter-6" data-pos="6">6 (後中)</button>
                        <button class="starter-btn" id="btn-starter-1" data-pos="1">1 (サーブ)</button>
                        <button id="btn-rotate-left" class="rotate-btn" title="反時計回り">↺</button>
                        <button id="btn-rotate-right" class="rotate-btn" title="時計回り (ローテ)">↻</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="btn-setup-cancel" class="action-btn cancel">キャンセル</button>
                <button id="btn-match-start" class="action-btn submit">試合開始</button>
                <button id="btn-next-set-start" class="action-btn submit" style="display: none;">次セット開始</button>
            </div>
        </div>
    </div>
    <div id="selection-modal">
        <div class="selection-modal-content">
            <div class="selection-modal-header">
                <button id="btn-selection-back" class="selection-nav-btn hidden-btn">&lt; 戻る</button>
                <h3 id="selection-title" class="selection-modal-title">選択してください</h3>
                <button id="btn-selection-close" class="selection-nav-btn">閉じる</button>
            </div>
            <div id="selection-list-container">
                </div>
        </div>
    </div>
    <div id="player-select-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content small">
            <h3 id="player-modal-title">選手を選択</h3>
            <div class="select-group">
                <select id="select-starter-player">
                    </select>
            </div>
            <div class="select-group">
                <label>ポジション</label>
                <select id="select-starter-role">
                    <option value="S">セッター</option>
                    <option value="OH">レフト</option>
                    <option value="MB">センター</option>
                    <option value="OP">ライト</option>
                </select>
            </div>
            <div class="modal-footer">
                <button id="btn-ps-cancel" class="action-btn">戻&nbsp;る</button>
                <button id="btn-ps-ok" class="action-btn submit">決&nbsp;定</button>
            </div>
        </div>
    </div>
    <div id="substitute-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2 id="substitute-modal-title">選手交代</h2>
            <div class="modal-body">
                <div class="select-group">
                    <label for="select-player-out">OUT (コート内)</label>
                    <select id="select-player-out">
                        </select>
                </div>
                <div class="select-group">
                    <label for="select-player-in">IN (ベンチ)</label>
                    <select id="select-player-in">
                        </select>
                </div>
            </div>
            <div class="modal-footer">
                <button id="btn-sub-cancel" class="action-btn cancel">キャンセル</button>
                <button id="btn-sub-execute" class="action-btn submit">選手交代</button>
            </div>
        </div>
    </div>
    <div id="libero-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2 id="libero-modal-title">リベロ交代</h2>
            <div id="libero-modal-body" class="modal-body">
                </div>
            <div class="modal-footer">
                <button id="btn-libero-cancel" class="action-btn cancel">キャンセル</button>
                <button id="btn-libero-execute" class="action-btn submit">実&nbsp;行</button>
            </div>
        </div>
    </div>
    <div id="log-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content full-height">
            <div class="modal-header">
                <h2>プレイ履歴</h2>
                <button id="btn-log-close" class="action-btn secondary">閉じる</button>
            </div>
            <div id="log-list-container" class="log-list">
                </div>
        </div>
    </div>
    <div id="reason-modal" class="modal-overlay" style="display: none; z-index: 3000;">
        <div class="modal-content" style="max-width: 400px;">
            <h3 id="reason-modal-title">得点理由</h3>
            <div id="reason-buttons-container" style="display:flex; flex-direction:column; gap:15px;">
                </div>
            <div style="margin: 10px; text-align: center;">
                <button class="action-btn" style="background:#999;" onclick="ReasonInputManager.close()">キャンセル</button>
            </div>
        </div>
    </div>
    <div id="set-end-modal" class="modal-overlay" style="display: none; z-index: 1200;">
        <div class="modal-content small">
            <h3>第 <span id="modal-set-num">1</span> セット 終了</h3>
            <p style="text-align:center; font-size:1.2em; font-weight:bold;">
                <span id="modal-set-score">25 - 23</span>
            </p>
            <p style="text-align:center;">このセットのデータを保存しました。</p>
            <div class="modal-footer" style="flex-direction: column; gap: 10px;">
                <button id="btn-goto-analysis" class="action-btn" style="background-color: var(--orange); color: black;">
                    速報分析を見る
                </button>
                <button id="btn-next-set" class="action-btn submit">
                    次セットへ進む →
                </button>
            </div>
        </div>
    </div>
    <div id="mid-match-exit-modal" class="modal-overlay" style="display: none; z-index: 1300;">
        <div class="modal-content small">
            <h3>確認</h3>
            <p style="text-align:center;">セットの途中ですが、試合を終了しますか？</p>
            <div class="modal-footer" style="flex-direction: column; gap: 10px;">
                <button id="btn-exit-cancel" class="action-btn cancel">試合続行</button>
                <button id="btn-exit-no-save" class="action-btn" style="background-color: var(--red);">保存せずに試合終了</button>
                <button id="btn-exit-save" class="action-btn submit">保存して試合終了</button>
            </div>
        </div>
    </div>
    <div id="match-end-modal" class="modal-overlay" style="display: none; z-index: 1300;">
        <div class="modal-content small">
            <h3>試合終了</h3>
            <p style="text-align:center;">お疲れ様でした。</p>
            <div class="modal-footer" style="flex-direction: column; gap: 10px;">
                <button id="btn-end-to-analysis" class="action-btn submit">分析画面へ</button>
                <button id="btn-end-to-home" class="action-btn cancel">ホームへ戻る</button>
            </div>
        </div>
    </div>
    <div id="share-overlay" class="modal-overlay" style="display: none; z-index: 10000;">
        <div class="modal-content" style="max-width: 400px;">
            <h3 style="color:var(--navy); margin-top:0;">レポート出力</h3>
            <p style="font-size:0.9rem; color:#666;">出力するデータを選択してください（複数可）</p>
            <div id="share-options-container" style="max-height: 300px; overflow-y: auto; margin: 15px 0;">
                </div>
            <div style="display:flex; gap:10px; justify-content: center; margin-top: 20px;">
                <button id="btn-share-png" class="action-btn" style="background:#2ECC71;">画像 (.png)</button>
                <button id="btn-share-pdf" class="action-btn" style="background:#E74C3C;">PDF (.pdf)</button>
            </div>
            <div style="text-align:center; margin-top:15px;">
                <button onclick="AnalysisManager.toggleSharePopup(false)" style="background:none; border:none; color:#888; cursor:pointer;">キャンセル</button>
            </div>
        </div>
    </div>
    <div id="feedback-message" class="feedback"></div>
    <script src="html2canvas.min.js"></script>
    <script src="jspdf.umd.min.js"></script>
    <script src="dexie.js"></script>
    <script src="Chart.js"></script>
    <script src="master_data.js"></script>
    <script src="vmetrics.js"></script>
    </body>
</html>